<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Actividad 3 - Web Component con Tabla</title>
  
</head>
<body>

<script>
class PostTableComponent extends HTMLElement {
  constructor() {
    super();
    
    // MODIFICADO: En lugar de un HTMLTextArea, se creo un contenedor para la tabla.
    this.tableContainer = document.createElement('div');
    
    // Botón para la solicitud
    this.requestBtn = document.createElement('button');
    this.requestBtn.innerText = 'Efectuar solicitud';
    
    // Adjunta los elementos al componente (se cambió outputTextArea por tableContainer)
    this.appendChild(this.requestBtn);
    this.appendChild(this.tableContainer);
  }

  // Método para manejar el clic del botón
  onRequestButtonClick(event) {
    var self = this;
    
    // Desactivar el botón para evitar múltiples solicitudes
    self.requestBtn.disabled = true;
    self.requestBtn.innerText = 'Cargando...';

    // MODIFICADO: El endpoint de la API ahora devuelve una lista de posts
    fetch('https://jsonplaceholder.typicode.com/posts')
      .then(function(response) {
        if (!response.ok) {
          throw new Error('Error en la solicitud: ' + response.statusText);
        }
        return response.json();
      })
      .then(function(data) {
        // MODIFICADO: En lugar de usar `JSON.stringify` y el `value` de un textarea, se llama a un nuevo método para renderizar la tabla.
        self.renderTable(data);
      })
      .catch(function(error) {
        console.error('Ocurrió un error:', error);
        self.tableContainer.innerHTML = '<p style="color:red;">Ocurrió un error al cargar los datos.</p>';
      })
      .finally(function() {
        // Habilitar el botón nuevamente
        self.requestBtn.disabled = false;
        self.requestBtn.innerText = 'Efectuar solicitud';
      });
  }

  // SE AGREGO: Nuevo método para crear y llenar la tabla HTML con los datos de la API.
  renderTable(data) {
    // Limpiar cualquier contenido previo
    this.tableContainer.innerHTML = '';
    
    if (!data || data.length === 0) {
      this.tableContainer.innerText = 'No se encontraron datos.';
      return;
    }

    var table = document.createElement('table');
    var thead = document.createElement('thead');
    var tbody = document.createElement('tbody');

    // AGREGADO: Obtener los encabezados de la tabla a partir de las claves del primer objeto en los datos.
    var headers = Object.keys(data[0]);
    var headerRow = document.createElement('tr');
    
    headers.forEach(function(headerText) {
      var th = document.createElement('th');
      th.innerText = headerText;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    
    // AGREGADO: Llenar el cuerpo de la tabla con los datos, creando una fila por cada elemento del arreglo.
    data.forEach(function(item) {
      var row = document.createElement('tr');
      headers.forEach(function(header) {
        var td = document.createElement('td');
        td.innerText = item[header];
        row.appendChild(td);
      });
      tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    this.tableContainer.appendChild(table);
  }

  // Callback del ciclo de vida del componente
  connectedCallback() {
    // Asignar el evento al botón
    this.requestBtn.onclick = this.onRequestButtonClick.bind(this);
  }
  
  // Callback del ciclo de vida del componente
  disconnectedCallback() {
    // Limpiar el evento para evitar fugas de memoria
    this.requestBtn.onclick = null;
  }
}

// Definir el Web Component
customElements.define('x-post-table', PostTableComponent);

function main() {
  var tableComponent = new PostTableComponent();
  document.body.appendChild(tableComponent);
}

// Ejecutar la función main al cargar la ventana
window.onload = main;
</script>

</body>
</html>